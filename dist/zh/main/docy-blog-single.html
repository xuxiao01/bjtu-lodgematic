<!DOCTYPE html><html lang="en"><head>
    <!-- 使用统一的页面加载器 -->
    <script src="/assets//js/app-head-bs.js"></script>
    <style>
        /* 设置绿色主题色 - 与其他页面保持一致 */
        :root {
            --color-primary: #60D1AE;
        }
    </style>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LodgeMatic - 智能短租管理平台</title>

    <!-- 样式 -->
    <link rel="stylesheet" href="/assets//docy/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets//docy/assets/elagent-icon/style.css">
    <link rel="stylesheet" href="/assets//docy/assets/animation/animate.css">
    <link rel="stylesheet" href="/assets//docy/css/style-main.css">
    <link rel="stylesheet" href="/assets//docy/css/responsive.css">
    <link rel="stylesheet" href="/assets//docy/css/bootstrap5-fixes.css">
    <!-- 博客组件样式 -->
    <link rel="stylesheet" href="/assets//docy/css/blog-components.css">
    <!-- Unicons图标库 -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">

    <!-- 新推特图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body data-scroll-animation="true" class="fixed-header">
    <div class="body_wrapper">
          <!-- 页头组件容器 -->
          <div id="blog-header"></div>

        <!-- 作者信息时间显示区域 -->
        <section class="breadcrumb_area_three">
            <div class="container">
                <div class="breadcrumb_content">
                    <h1 id="article-title">测试文章</h1>
                    <div class="single_post_author">
                        <img class="author_img" id="author-img" src="" alt="author">
                        <div class="text">
                            <a href="#">
                                <h4 id="author-name">李白</h4>
                            </a>
                            <div class="post_tag">
                                <a href="#" id="publish-date">2025-12-03</a>
                                <a href="#" id="read-time">10分钟阅读</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="blog_area">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="blog_single_info">
                            <div class="blog_single_item">
                                <!-- <a href="#" class="blog_single_img">
                                    <img id="blog-img" src="" alt="Main Image">
                                </a> -->
                                <!-- ✅ 动态内容统一插入点 -->
                                <div id="article-content"></div>

                                <!-- 分享文章+4个按钮 -->
                                <div class="blog_social text-center">
                                    <h5>Share This Article</h5>
                                    <ul class="list-unstyled f_social_icon">
                                        <li><a href="#"><i class="social_facebook"></i></a></li>
                                        <li><a href="#"><i class="fa-brands fa-x-twitter"></i></a></li>
                                        <li><a href="#"><i class="social_vimeo"></i></a></li>
                                        <li><a href="#"><i class="social_linkedin"></i></a></li>
                                    </ul>
                                </div>

                            </div>
                        </div>
                    </div>


                    <div class="col-lg-4">
                        <!-- 文章分类侧边选项 -->
                        <div class="widget categorie_widget">
                            <h4 class="c_head">Post Categories</h4>
                            <ul class="list-unstyled categorie_list">
                                <li><a href="#">Creative <span>(12)</span></a></li>
                                <li><a href="#">Inspiration <span>(8)</span></a></li>
                                <li><a href="#">Lifestyle <span>(3)</span></a></li>
                                <li><a href="#">News <span>(4)</span></a></li>
                                <li><a href="#">Photography <span>(12)</span></a></li>
                                <li><a href="#">Skill <span>(15)</span></a></li>
                                <li><a href="#">Tourist Tours <span>(10)</span></a></li>
                                <li><a href="#">Inspire <span>(5)</span></a></li>
                            </ul>
                        </div>

                        <!-- tag 侧边栏 -->
                        <div class="widget tag_widget">
                            <h4 class="c_head">Tags</h4>
                            <ul class="list-unstyled w_tag_list">
                                <li><a href="#">Design</a></li>
                                <li><a href="#">Apps</a></li>
                                <li><a href="#">Photography</a></li>
                                <li><a href="#">Business</a></li>
                                <li><a href="#">Docy</a></li>
                                <li><a href="#">WordPress</a></li>
                                <li><a href="#">Design</a></li>
                                <li><a href="#">DocAll</a></li>
                                <li><a href="#">Magento</a></li>
                                <li><a href="#">Doc Design</a></li>
                                <li><a href="#">ui/ux</a></li>
                                <li><a href="#">Docs</a></li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>




        </section>




       <!-- 页脚组件容器 -->
       <div id="blog-footer"></div>
    </div>

    <!-- Back to top button -->
    <a id="back-to-top" title="Back to Top"></a>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS (Bootstrap 5 with jQuery compatibility) -->
    <script src="/assets//docy/js/jquery-3.7.1.min.js"></script>
    <script src="/assets//docy/js/pre-loader.js"> </script>
    <script src="/assets//docy/assets/bootstrap/js/popper.min.js"></script>
    <script src="/assets//docy/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets//docy/js/parallaxie.js"></script>
    <script src="/assets//docy/js/TweenMax.min.js"></script>
    <script src="/assets//docy/js/jquery.wavify.js"></script>
    <script src="/assets//docy/assets/wow/wow.min.js"></script>
    <script src="https://unpkg.com/ionicons@5.4.0/dist/ionicons.js"></script>
    <script src="/assets//docy/js/main.js"></script>
    <!-- 数据与渲染 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/assets//docy/api/samAxios.js"></script>
    <script src="/assets//docy/api/services/getblog.js"></script>
    <!-- 已移除 mock-articles.js 和 blog-single-render.js，改用真实 API -->
    
    <!-- 博客内容渲染 -->
    <script>
        /**
         * 处理 base64 图片，确保能正确显示
         * @param {string} html - HTML 内容字符串
         * @returns {string} 处理后的 HTML
         */
        function processBase64Images(html) {
            if (!html || typeof html !== 'string') {
                return html || '';
            }
            
            // 如果 content 中已经有完整的 data URI（data:image/...），直接返回
            // 否则，查找可能的 base64 字符串并转换为 data URI
            
            // 匹配可能的 base64 图片标签，但没有 data URI 前缀的情况
            // 例如：<img src="/9j/4AAQSkZJRg..." /> 这种情况
            html = html.replace(
                /<img\s+([^>]*src=["'])([^"']+)(["'][^>]*)>/gi,
                function(match, beforeSrc, srcValue, afterSrc) {
                    // 如果已经是 data URI，不处理
                    if (srcValue.startsWith('data:image/')) {
                        return match;
                    }
                    // 如果看起来像 base64（长字符串，没有 http/https），尝试添加前缀
                    if (srcValue.length > 100 && !srcValue.startsWith('http') && !srcValue.startsWith('/')) {
                        // 尝试检测图片类型
                        var mimeType = 'image/png'; // 默认 png
                        if (srcValue.startsWith('/9j/') || srcValue.startsWith('iVBORw0KGgo')) {
                            mimeType = 'image/jpeg';
                        } else if (srcValue.startsWith('iVBORw0KGgo')) {
                            mimeType = 'image/png';
                        } else if (srcValue.startsWith('R0lGOD')) {
                            mimeType = 'image/gif';
                        }
                        return '<img ' + beforeSrc + 'data:' + mimeType + ';base64,' + srcValue + afterSrc + '>';
                    }
                    return match;
                }
            );
            
            return html;
        }

        /**
         * 渲染博客内容到页面
         * @param {object} data - API 返回的博客数据
         */
        function renderBlogContent(data) {
            if (!data) {
                console.warn('博客数据为空');
                return;
            }

            // 渲染标题
            var titleEl = document.getElementById('article-title');
            if (titleEl && data.title) {
                titleEl.textContent = data.title;
            }

            // 渲染作者信息
            if (data.author) {
                // 渲染作者名字
                var authorNameEl = document.getElementById('author-name');
                if (authorNameEl && data.author.name) {
                    authorNameEl.textContent = data.author.name;
                }

                // 渲染作者头像
                var authorImgEl = document.getElementById('author-img');
                if (authorImgEl && data.author.avatarUrl) {
                    authorImgEl.src = data.author.avatarUrl;
                    authorImgEl.alt = data.author.name || '作者头像';
                }
            }

            // 渲染内容
            var contentEl = document.getElementById('article-content');
            if (contentEl && data.content) {
                // 处理 base64 图片并渲染内容
                var processedContent = processBase64Images(data.content);
                contentEl.innerHTML = processedContent;
                console.log('✅ 博客内容已渲染');
            } else {
                console.warn('未找到 content 字段或 article-content 元素');
            }
        }

        // 等待页面和 API 加载完成后调用接口
        document.addEventListener('DOMContentLoaded', function() {
            // 等待 samAxios 和 BlogAPI 初始化完成
            setTimeout(function() {
                if (window.BlogAPI && window.api) {
                    console.log('开始加载博客内容...');
                    
                    // 从 URL 参数获取 blogId，如果没有则使用默认值
                    var urlParams = new URLSearchParams(window.location.search);
                    var blogId = urlParams.get('id') || '1439908264997728256';
                    
                    window.BlogAPI.getBlog(blogId)
                        .then(function(data) {
                            console.log('✅ API 调用成功，返回数据:', data);
                            renderBlogContent(data);
                        })
                        .catch(function(error) {
                            console.error('❌ API 调用失败:', error);
                            var contentEl = document.getElementById('article-content');
                            if (contentEl) {
                                contentEl.innerHTML = '<p style="color: red;">加载博客内容失败，请稍后重试。</p>';
                            }
                        });
                } else {
                    console.warn('BlogAPI 或 window.api 未初始化');
                }
            }, 500); // 延迟 500ms 确保 API 已加载
        });
    </script>

       <!-- 国际化系统 -->
       <script src="/assets//js/i18n.js"></script>
       <!-- 博客组件加载器 -->
       <script src="/assets//docy/js/blog-include.js"></script>
       <!-- 页面跳转加载动画 -->
       <script src="/assets//js/page-transition.js"></script>


</body></html>